# 專案需求規格書：分散式個人圖書借閱系統 (MVP)

**版本：** 1.0 (書架管理階段)
**日期：** 2025-12-17
**性質：** Client-side Serverless Web App

---

## 1. 專案願景與目標

建立一個輕量級、無伺服器負擔的個人圖書管理工具。讓使用者能快速建立自己的藏書清單，並透過單一連結分享給朋友。

- **核心價值：** 零成本部署、無須登入註冊、即用即走。
- **MVP 階段目標：** 完成「書架展示」與「書籍 CRUD」功能，並驗證「狀態即網址 (State as URL)」的可行性。

---

## 2. 核心架構決策 (Core Architectural Decisions)

本專案採用非傳統的資料儲存方式，以下是關鍵決策及其背後的理由：

### 2.1 資料儲存：URL Hash (狀態即網址)

- **描述：** 所有的書籍資料（ISBN、狀態、日期）都經過壓縮編碼後，儲存在網址的 Hash (`#`) 片段中。
- **設計理由 (Why)：**
  - **零維護成本：** 不需要架設後端資料庫 (NoSQL/SQL)，省去伺服器費用與維護精力。
  - **隱私與去中心化：** 資料完全掌握在持有者手中，不存留在任何第三方伺服器。
  - **便於分享：** 「連結」本身就是「資料庫」，分享連結即分享書架。

### 2.2 書籍資訊來源：Google Books API + 本地快取

- **描述：** 系統僅儲存最精簡的 ISBN，書名、封面圖等詳細資訊透過 API 即時查詢，並快取於瀏覽器。
- **設計理由 (Why)：**
  - **節省 URL 空間：** 瀏覽器網址長度有限（約 2000 字元），若存入書名與圖片連結會瞬間爆量。僅存 ISBN 可最大化書架容量。
  - **資料一致性：** 確保書籍資訊（如書名、封面）是標準化的，減少使用者手動輸入錯誤。
  - **效能優化：** 利用瀏覽器 LocalStorage 快取查詢結果，避免重複消耗 API 額度並提升載入速度。

---

## 3. 使用者角色 (User Roles)

| 角色                       | 描述                   | 主要權責                                            |
| :------------------------- | :--------------------- | :-------------------------------------------------- |
| **圖書持有者 (Owner)**     | 擁有書籍並建立連結的人 | 新增/刪除書籍、設定書籍狀態、產生分享連結。         |
| **借閱者/瀏覽者 (Viewer)** | 收到連結的人           | 瀏覽書架內容、查看書籍狀態 (MVP 階段暫無借閱功能)。 |

---

## 4. 功能需求與互動流程 (Functional Requirements)

### 4.1 書架瀏覽 (Dashboard View)

**目標：** 讓任何持有連結的人能清晰地查看書籍列表。

- **互動流程：**
  1.  使用者打開網址。
  2.  系統解析網址 Hash，還原書籍清單。
  3.  列表逐一顯示，初始顯示 ISBN。
  4.  系統背景非同步查詢書籍 Metadata（封面、書名）。
  5.  資料載入完成後，自動更新列表內容。
- **欄位呈現：**
  - 封面圖 (Thumbnail)
  - 書名與作者
  - ISBN (輔助資訊)
  - 購入/上架日期
  - 書籍格式標籤 (紙本/電子書)
  - 目前狀態 (可借閱/不可借閱)
- **設計決策：**
  - **非同步載入：** 避免因為 API 回應慢而導致整個頁面空白（白屏），優先顯示骨架或基礎資訊。

### 4.2 新增書籍 (Create)

**目標：** 持有者能快速將實體書轉化為數位資料。

- **互動流程：**
  1.  持有者點擊「新增書籍」按鈕。
  2.  系統彈出輸入框，要求輸入 ISBN。
  3.  持有者輸入 ISBN 並選擇「書籍格式」（紙本/電子書）。
  4.  系統驗證 ISBN 格式（基本長度檢查）。
  5.  系統將新書加入清單，並**立即變更瀏覽器網址**。
  6.  系統觸發 API 查詢並更新畫面。
- **設計決策：**
  - **預設值策略：** 「購入日期」預設帶入當天，「狀態」預設為「可借閱」，減少操作步驟。
  - **電子書防呆：** 雖由使用者選擇格式，但系統需在 UI 上區分，為未來「電子書不可借閱」的規則預作準備。

### 4.3 編輯與刪除 (Update / Delete)

**目標：** 維護書架的正確性。

- **互動流程 (刪除)：**
  1.  持有者在特定書籍列點擊「刪除」。
  2.  系統跳出確認對話框 (Confirm Dialog)。
  3.  確認後，移除該筆資料，並**立即變更瀏覽器網址**。
- **互動流程 (狀態變更)：**
  1.  持有者點擊書籍狀態（例如由「可借閱」改為「借出中」）。
  2.  系統更新內部狀態，並**立即變更瀏覽器網址**。
- **設計決策：**
  - **無後端儲存的副作用：** 必須明確告知使用者「任何修改都會導致網址改變」。舊的網址不會同步更新，這是一個架構上的 Trade-off。

### 4.4 分享書架 (Share)

**目標：** 解決 URL 變動造成的分享困難。

- **互動流程：**
  1.  當持有者進行任何 CRUD 操作導致網址變更時，UI 應有明顯提示。
  2.  介面提供一個顯眼的「複製目前書架連結」按鈕。
  3.  點擊後，將當前網址複製到剪貼簿，並顯示「複製成功」提示。
- **設計決策：**
  - **單向快照 (Snapshot) 概念：** 透過 UI 引導，讓使用者理解他分享出去的是「這一刻的書架快照」。

---

## 5. 系統限制與邊界 (Constraints & Boundaries)

### 5.1 儲存容量限制

- **限制：** 受限於瀏覽器與伺服器對 URL 長度的支援（安全值約 2,000 bytes）。
- **影響：** 預估書架上限約為 **40~60 本書** (視資料壓縮率而定)。超過此數量可能導致連結截斷或無法開啟。
- **對策：** 系統應在書籍數量接近臨界值時顯示警告。

### 5.2 資料持久性風險

- **限制：** 資料不存在伺服器，只存在於「連結」中。
- **影響：** 若持有者遺失了含有最新資料的連結，且瀏覽器紀錄也被清除，該書架資料將**永久遺失**，無法救援。
- **對策：** 建議使用者將連結加入「我的最愛」或自行筆記。

### 5.3 API 查詢限制

- **限制：** Google Books API 在無 Key 模式下有 IP 頻率限制。
- **影響：** 若短時間內大量新增書籍，或多人共用 IP 瀏覽，可能出現圖片/書名無法顯示的情況。
- **對策：** 嚴格執行 LocalStorage 快取機制。

---

## 6. 未來擴充規劃 (Out of Scope for MVP)

_(此區塊僅供架構參考，不包含在本期開發)_

- **借閱請求功能：** 點擊借閱按鈕後，自動生成包含 ISBN 與書名的訊息範本，導向 Email 或 Line 應用程式。
- **多書架管理：** 利用 LocalStorage 儲存多組 URL Hash，讓使用者能切換不同的書單。
- **匯入/匯出：** 支援 CSV 或純文字格式的 ISBN 批次匯入。
